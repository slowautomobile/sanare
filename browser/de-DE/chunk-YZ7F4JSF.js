import{$ as k,Q as $,ba as B,c as C,g as D,i as T,j as E,n as I,r as y,s as L,u as A,y as w}from"./chunk-GFQNWPHU.js";import"./chunk-2KRI6ZBU.js";import{A as F,B as S,d as b}from"./chunk-EZNRQUAM.js";import"./chunk-IQUW5QUP.js";import"./chunk-FYGCA5T3.js";import"./chunk-QABDRPPI.js";import"./chunk-CSA5XVMK.js";import{A as p,Ab as u,Bb as d,Ob as h,Ta as f,a as m,b as g,bb as P,e as v,fc as _,la as o,rb as c}from"./chunk-MOGN5K2H.js";var W=(()=>{class l{constructor(){this.programsService=o(D),this._snackBar=o(S),this.dialog=o(I),this.router=o(b),this.clientsService=o(T),this.shareClientsDataService=o(E),this.usersService=o(F),this.shareStateService=o(C),this.activePageTitle=o(L),this.pageTitle=this.activePageTitle.pageTitle,this.pageType="program",this.dataSource=new $(),this.isFetchingData=this.shareStateService.isFetchingData,this.programs=[],this.subscriptions=new v(),this.reuseProgram=this.shareClientsDataService.reuseProgram,this.userFavorites=this.usersService.userFavorites,this.userId=this.usersService.userId,this.isAdmin=this.usersService.isAdmin,this.clientInfo=this.shareClientsDataService.clientInfo,this.isAdminProgram=this.programsService.isAdminProgram,this.getPrograms("all");}ngOnInit(){this.pageTitle.set("Programme"),this.clientInfo.set({clientId:"",clientName:"",programPosition:0,programId:"",programName:"",dateRange:{start:"",end:""}});}createProgram(){this.router.navigateByUrl("/programs/form");}getPrograms(i){if(this.isFetchingData.set(!0),i==="all"){let r=p([this.programsService.getPrograms(),this.clientsService.getAllClientsPrograms()]).subscribe(([e,t])=>{this.programs=[];let s=t.map(a=>a.program);this.programs=[...e,...s],this.programs.forEach(a=>{this.userFavorites().favPrograms.some(n=>n===a.id)?a.isFavorite=!0:a.isFavorite=!1;}),this.programs.sort((a,n)=>a.name.localeCompare(n.name)),this.dataSource.data=this.programs,this.isFetchingData.set(!1);});this.subscriptions.add(r);}else if(i==="template"){this.isFetchingData.set(!0);let r=this.programsService.getPrograms().subscribe(e=>{this.programs=[],this.programs=e,this.programs.forEach(t=>{this.userFavorites().favPrograms.some(s=>s===t.id)?t.isFavorite=!0:t.isFavorite=!1;}),this.programs.sort((t,s)=>t.name.localeCompare(s.name)),this.dataSource.data=this.programs,this.isFetchingData.set(!1);});this.subscriptions.add(r);}else if(i==="client"){this.isFetchingData.set(!0);let r=this.clientsService.getAllClientsPrograms().subscribe(e=>{this.programs=[];let t=e.map(s=>s.program);this.programs=t,this.programs.forEach(s=>{this.userFavorites().favPrograms.some(a=>a===s.id)?s.isFavorite=!0:s.isFavorite=!1;}),this.programs.sort((s,a)=>s.name.localeCompare(a.name)),this.dataSource.data=this.programs,this.isFetchingData.set(!1);});this.subscriptions.add(r);}else i==="favorite"&&this._getFavoritePrograms();}_getFavoritePrograms(){this.isFetchingData.set(!0);let i=p([this.programsService.getPrograms(),this.clientsService.getAllClientsPrograms()]).subscribe(([r,e])=>{this.programs=[];let t=[],s=e.map(a=>a.program);this.programs=[...r,...s],t=this.programs.filter(a=>this.userFavorites().favPrograms.some(n=>n===a.id)?(a.isFavorite=!0,!0):(a.isFavorite=!1,!1)),t.sort((a,n)=>a.name.localeCompare(n.name)),this.dataSource.data=t,this.isFetchingData.set(!1);});this.subscriptions.add(i);}openEditProgram(i){let r=this.programs.find(e=>e.id===i);this.clientInfo.update(e=>g(m({},e),{programName:r.name})),this.router.navigate([`programs/form/${i}`],{queryParams:{programName:`${r.name}`,isClientProgram:r.isTemplate?"false":"true"}});}reuseEditProgram(i){this.reuseProgram.set(!0);let r=this.programs.find(e=>e.id===i.programId);this.clientInfo.update(e=>g(m({},e),{programName:r.name})),console.log(this.clientInfo()),this.router.navigate([`programs/form/${r.id}`],{queryParams:{programName:`${r.name}`,isClientProgram:r.isTemplate?"false":"true"}});}addClient(i){console.log("open program and add client automatically");}openDeleteConfirmationDialog(i){let r=this.dialog.open(k,{width:"312px",data:{title:"Ausgew\xE4hltes Programm l\xF6schen?",message:"Durch das L\xF6schen des ausgew\xE4hlten Programms wird es aus Ihrem Konto entfernt."},panelClass:"custom-dialog"}),e=r.afterClosed().subscribe(t=>{t?(console.log("User confirmed deletion"),this.deleteProgram(i.itemId,i.listOption),r.close()):(console.log("User canceled deletion"),r.close());});this.subscriptions.add(e);}deleteProgram(i,r){let e=this.programs.find(s=>s.id===i),t;e.isTemplate?t=this.programsService.deleteProgram(i).subscribe(()=>{this.getPrograms(r);}):t=this.clientsService.deleteClientProgram(e.clientId,e.position).subscribe(()=>{this.getPrograms(r);}),this.subscriptions.add(t),this._snackBar.open("Programm gel\xF6scht","",{duration:2e3,panelClass:["custom-snackbar-style"]});}_updateFavorites(i,r){let e=this.usersService.updateFavorites(i,r).subscribe(t=>console.log(t));this.subscriptions.add(e);}addToFavorites(i){this.userFavorites.update(r=>{let e=i.id,t=g(m({},r),{favPrograms:[...r.favPrograms,e]});return this._updateFavorites(this.userId(),t),t;});}removeFromFavorites(i){let r=this.userFavorites().favPrograms.filter(e=>e!==i.id);this.userFavorites.update(e=>g(m({},e),{favPrograms:[...r]})),this._updateFavorites(this.userId(),this.userFavorites());}ngOnDestroy(){this.subscriptions.unsubscribe();}static{this.ɵfac=function(r){return new(r||l)();};}static{this.ɵcmp=P({type:l,selectors:[["sanareapp-programs-list"]],features:[_([{provide:w,useClass:y}])],decls:2,vars:7,consts:[[3,"newEvent","pageTitle","newButton","pageType"],[3,"getProgramsEvent","reuseEditProgramEvent","openEditProgramEvent","openDeleteConfirmationDialogEvent","favoriteProgram","removeFavoriteProgram","isAdmin","isAdminProgram","mainProgramsList","dataSource"]],template:function(r,e){r&1&&(u(0,"ui-page-toolbar",0),h("newEvent",function(){return e.createProgram();}),d(),u(1,"ui-programs-table",1),h("getProgramsEvent",function(s){return e.getPrograms(s);})("reuseEditProgramEvent",function(s){return e.reuseEditProgram(s);})("openEditProgramEvent",function(s){return e.openEditProgram(s);})("openDeleteConfirmationDialogEvent",function(s){return e.openDeleteConfirmationDialog(s);})("favoriteProgram",function(s){return e.addToFavorites(s);})("removeFavoriteProgram",function(s){return e.removeFromFavorites(s);}),d()),r&2&&(c("pageTitle",e.pageTitle())("newButton",!0)("pageType","program"),f(),c("isAdmin",e.isAdmin())("isAdminProgram",e.isAdminProgram())("mainProgramsList",!0)("dataSource",e.dataSource));},dependencies:[A,B],encapsulation:2});}}return l;})();export{W as ProgramsListComponent};/**i18n:e9421f27e91e2550a5a0bd03ad694673877e5a8020798e378092da15c61db7f3*/